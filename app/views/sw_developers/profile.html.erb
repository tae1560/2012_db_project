<%= render 'menu' %>

<div class="fullsize_box box">
  <h2>계정 정보</h2>
</div>

<%= render 'users/profile' %>

<!-- 개발자용 프로필 -->

단가, 전문분야, 점수평점
<ul>
  <li>단가 : <%= @user.sw_developer.developer_pay %></li>
  <li>전문분야 :
    <% if @user.sw_developer.pro_fields.empty? %>
        아직 선택하지 않았습니다.
    <% else %>
        <ul>
          <% @user.sw_developer.pro_fields.each do |pro_field| %>
              <li style="display: inline-block;margin-right: 5px;"><%= pro_field.name %></li>
          <% end #each %>
        </ul>
    <% end #if-else %>
  </li>
  <li>
    점수평점 :
    <%
       _creativity = 0;
       _concentration = 0;
       _skill = 0;
       _will = 0;
       count = 0;

       @development_results.each do |development_result|
         development_result.evaluation_results.each do |result|
           _creativity += result.creativity;
           _concentration += result.concentration;
           _skill += result.skill;
           _will += result.will;
           count += 1;
         end
       end

       if count == 0
         count = 1
       end
    %>
    창의력 : <%= _creativity/count %>
    몰입력 : <%= _concentration/count %>
    기술력 : <%= _skill/count %>
    의지력 : <%= _will/count %>
  </li>
</ul>


<div class="fullsize_box box">
  <h2>개발결과물</h2>
</div>

<div class="fullsize_box box">
  <h3>개발결과물 목록</h3>
  <hr />
  <% if @development_results.empty? %>
      <div class="small_msg">업로드한 개발결과물이 없습니다!</div>
      <hr />
  <% else %>
      <% @development_results.each do |development_result| %>
          <div>
            <h4 class="developer_upload pseudo_link dropdown"><%= development_result.name %> </h4>
            <ul class="developer_upload_list" style="display:none">
              <li>고유 관리번호 : <%= development_result.id %></li>
              <li>전문분야 :
                <% if development_result.pro_fields.empty? %>
                    <div class="small_msg">평가 대기 중입니다.</div>
                <% else %>
                    <ul>
                      <% development_result.pro_fields.each do |pro_field| %>
                          <li style="display: inline-block;margin-right: 5px;"><%= pro_field.name %></li>
                      <% end #each %>
                    </ul>
                <% end #if-else %>
              </li>

              <li>첨부자료 :
                <ul>
                  <% development_result.result_files.each do |result_file| %>
                      <li><%= link_to result_file.path, "/data/" + result_file.path, :target => '_blank' %></li>
                  <% end %>
                </ul>
              </li>

              <li>평가결과 :
                <% if development_result.evaluation_results.empty? %>
                    <div class="small_msg">평가 대기 중입니다.</div>
                <% else %>
                    <div class="box fullsize_box">

                      <%
                         _creativity = 0;
                         _concentration = 0;
                         _skill = 0;
                         _will = 0;
                         count = 0;

                         development_result.evaluation_results.each do |result|
                           _creativity += result.creativity;
                           _concentration += result.concentration;
                           _skill += result.skill;
                           _will += result.will;
                           count += 1;
                         end
                      %>

                      <div class="bar_score">
                        <div class="bar_container">
                          <div class="bar_general bar_creativity" style="width:<%= _creativity / count / 4 %>%"></div>
                          <div class="bar_general bar_concentration" style="width:<%= _concentration / count / 4 %>%"></div>
                          <div class="bar_general bar_skill" style="width:<%= _skill / count / 4 %>%"></div>
                          <div class="bar_general bar_will" style="width:<%= _will / count / 4 %>%"></div>
                        </div>
                        <div class="bar_index">
                          <span class="score_number"><%= (_creativity + _concentration + _skill + _will) %></span>
                          <span class="underscore"> / 400 </span>
                        </div>
                      </div>

                      <ul>
                        <li class="font_creativity">창의력 : <span class="score_number"><%= _creativity %></span>
                          <span class="underscore"> / 100 </span><div class="star"></div></li>
                        <li class="font_concentration">몰입력 : <span class="score_number"><%= _concentration %></span>
                          <span class="underscore"> / 100 </span><div class="star"></div></li>
                        <li class="font_skill">기술력 : <span class="score_number"><%= _skill %></span>
                          <span class="underscore"> / 100 </span><div class="star"></div></li>
                        <li class="font_will">의지력 : <span class="score_number"><%= _will %></span>
                          <span class="underscore"> / 100 </span><div class="star"></div></li>
                      </ul>


                    </div>
                <% end #if-else %>
              </li>
            </ul>
            <hr />
          </div>
      <% end #each %>
  <% end #if-else %>
</div>

<script type="text/javascript">
    $(".developer_upload").click(function(){
        if ($(this).parent().find(".developer_upload_list").is(":hidden")) {
            $(this).parent().find(".developer_upload_list").slideDown(350);
            $(this).parent().find(".bar_general").width(0);
            $(this).parent().find(".bar_creativity").animate({width:$(this).parent().find(".font_creativity .score_number").html() / 4 + "%"}, 1000);
            $(this).parent().find(".bar_concentration").delay(200).animate({width:$(this).parent().find(".font_concentration .score_number").html() / 4 + "%"}, 1000);
            $(this).parent().find(".bar_skill").delay(400).animate({width:$(this).parent().find(".font_skill .score_number").html() / 4 + "%"}, 1000);
            $(this).parent().find(".bar_will").delay(600).animate({width:$(this).parent().find(".font_will .score_number").html() / 4 + "%"}, 1000);
        }
        else {$(this).parent().find(".developer_upload_list").slideUp(350);}
    });

    $(".star").raty({
        half : true
    });

    $(".score_number").keyup(function(){
        $(this).parent().find(".star").raty('score', this.innerHTML / 20.0).raty('readOnly', true);
    });

    $(".score_number").keyup();

</script>
